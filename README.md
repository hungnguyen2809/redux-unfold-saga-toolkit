# redux-unfold-saga-toolkit

A more user-friendly, headache-free redux-saga middleware.

> This library is inspired by [redux-unfold-saga](https://github.com/manhhailua/redux-unfold-saga).

## Getting started

#### Install

```bash
npm install --save redux-unfold-saga-toolkit
```

or

```bash
yarn add redux-unfold-saga-toolkit
```

> This library is required [redux-saga](https://redux-saga.js.org/docs/introduction/GettingStarted) and [immer](https://immerjs.github.io/immer/installation)

#### Usage example

- action

```typescript
import { createAction } from 'redux-unfold-saga-toolkit';

const fetchPosts = createAction('FETCH_POSTS');

dispatch(
  fetchPosts(
    { category: 'HOT' },
    {
      onBegin: () => {
        // Do something before the query
        setLoading(true);
      },
      onFailure: (error: Error) => {
        // Do something in case of caught error
      },
      onSuccess: (posts: IPost[]) => {
        // Do something after the query succeeded
      },
      onFinish: () => {
        // Do something after everything is done
        setLoading(false);
      },
    },
  ),
);
```

- saga

```typescript
import { call, takeLatest } from 'redux-saga/effects';
import { unfoldSaga } from 'redux-unfold-saga-toolkit';

function* takeQueryPosts(action: UnfoldSagaActionType): Iterable<SagaIterator> {
  yield unfoldSaga({
    action: action,
    handler: function* () {
      const data = yield call(ApiPost.listPost);
      return data;
    },
  });
}

function* defaultSaga() {
  yield takeLatest('QUERY_POSTS', takeQueryPosts);
  // yield takeLatest(fetchPosts, takeQueryPosts);
  // yield takeLatest(fetchPosts.type, takeQueryPosts);
}
```

- reducer

```typescript
import { createReducer, createStoreAction } from 'redux-unfold-saga-toolkit';

const fetchPosts = createStoreAction('FETCH_POSTS');

const initState = {
  posts: [],
  error: null,
  loading: true,
};

const postReducer = createReducer(initState, (builder) => {
  builder.addCase<void>(fetchPosts.begin, (state, action) => {
    state.loading = true;
  });
  builder.addCase<void>(fetchPosts.finish, (state, action) => {
    state.loading = false;
  });
  builder.addCase<IPost[]>(fetchPosts.success, (state, action) => {
    state.posts = action.payload;
  });
  builder.addCase<Error>(fetchPosts.failure, (state, action) => {
    state.error = action.payload;
  });
});
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

- [createActionTypeOnBegin][1]
  - [Parameters][2]
  - [Examples][3]
- [createActionTypeOnFinish][4]
  - [Parameters][5]
  - [Examples][6]
- [createActionTypeOnSuccess][7]
  - [Parameters][8]
  - [Examples][9]
- [createActionTypeOnFailure][10]
  - [Parameters][11]
  - [Examples][12]
- [createAction][13]
  - [Parameters][14]
  - [Examples][15]
- [createStoreAction][16]
  - [Parameters][17]
  - [Examples][18]
- [createReducer][19]
  - [Parameters][20]
  - [Examples][21]
- [unfoldSaga][22]
  - [Parameters][23]
  - [Examples][24]

## createActionTypeOnBegin

Create onBegin action type

### Parameters

- `key` &#x20;

### Examples

```javascript
import { createActionTypeOnBegin } from 'redux-unfold-saga-toolkit';

createActionTypeOnBegin('DO_SOMETHING'); // DO_SOMETHING_BEGAN
```

Returns **[string][25]** `${key}_BEGAN`

## createActionTypeOnFinish

Create onFinish action type

### Parameters

- `key` &#x20;

### Examples

```javascript
import { createActionTypeOnFinish } from 'redux-unfold-saga-toolkit';

createActionTypeOnFinish('DO_SOMETHING'); // DO_SOMETHING_FINISHED
```

Returns **[string][25]** `${key}_FINISHED`

## createActionTypeOnSuccess

Create onSuccess action type

### Parameters

- `key` &#x20;

### Examples

```javascript
import { createActionTypeOnSuccess } from 'redux-unfold-saga-toolkit';

createActionTypeOnSuccess('DO_SOMETHING'); // DO_SOMETHING_SUCCEEDED
```

Returns **[string][25]** `${key}_SUCCEEDED`

## createActionTypeOnFailure

Create onFailure action type

### Parameters

- `key` &#x20;

### Examples

```javascript
import { createActionTypeOnFailure } from 'redux-unfold-saga-toolkit';

createActionTypeOnFailure('DO_SOMETHING'); // DO_SOMETHING_FAILED
```

Returns **[string][25]** `${key}_FAILED`

## createAction

Create an action for real life usage inside or even outside of a component, no dispatch to reducer

### Parameters

- `type` &#x20;

### Examples

```javascript
import {createAction} from 'redux-unfold-saga-toolkit';

const fetchPosts = createAction<IPostPayload>('FETCH_POSTS');

dispatch(
  fetchPosts(
    {category: 'HOT'},
    {
      onBegin: () => {
        // Do something before the query
        setLoading(true);
      },
      onFailure: (error: Error) => {
        // Do something in case of caught error
      },
      onSuccess: (posts: IPost[]) => {
        // Do something after the query succeeded
      },
      onFinish: () => {
        // Do something after everything is done
        setLoading(false);
      },
    },
  ),
);
```

Returns **UnfoldSagaActionCreator** action

## createStoreAction

Create an action for real life usage inside or even outside of a component, dispatch to reducer with automatic create action type

### Parameters

- `type` &#x20;

### Examples

```javascript
// Action
import {createStoreAction, createReducer} from 'redux-unfold-saga-toolkit';

const fetchPosts = createStoreAction<IPostPayload>('FETCH_POSTS');

dispatch(
  fetchPosts(
    {category: 'HOT'},
    {
      onBegin: () => {
        // Do something before the query
        setLoading(true);
      },
      onFailure: (error:Error) => {
        // Do something in case of caught error
      },
      onSuccess: (posts:IPost) => {
        // Do something after the query succeeded
      },
      onFinish: () => {
        // Do something after everything is done
        setLoading(false);
      },
    },
  ),
);

// Reducer
const initState = {
        posts: [],
        error: null,
        loading: true,
};

const postReducer = createReducer(initState, (builder) => {
  builder.addCase<void>(fetchPosts.begin, (state, action) => {
    state.loading = true;
  });
  builder.addCase<void>(fetchPosts.finish, (state, action) => {
    state.loading = false;
  });
  builder.addCase<IPost[]>(fetchPosts.success, (state, action) => {
    state.posts = action.payload;
  });
  builder.addCase<Error>(fetchPosts.failure, (state, action) => {
    state.error = action.payload;
  });
})
```

Returns **UnfoldSagaActionCreator** action

## createReducer

A utility function that allows defining a reducer as a mapping from action
type to _case reducer_ functions that handle these action types. The
reducer's initial state is passed as the first argument.

### Parameters

- `initialState` &#x20;
- `builderCallback` &#x20;

### Examples

```javascript
// Action

import {createStoreAction, createReducer} from 'redux-unfold-saga-toolkit';

const fetchPosts = createStoreAction<IPostPayload>('FETCH_POSTS');

dispatch(
  fetchPosts(
    {category: 'HOT'},
    {
      onBegin: () => {
        // Do something before the query
        setLoading(true);
      },
      onFailure: (error:Error) => {
        // Do something in case of caught error
      },
      onSuccess: (posts:IPost) => {
        // Do something after the query succeeded
      },
      onFinish: () => {
        // Do something after everything is done
        setLoading(false);
      },
    },
  ),
);

// Reducer
const initState = {
        posts: [],
        error: null,
        loading: true,
};

const postReducer = createReducer(initState, (builder) => {
  builder.addCase<void>(fetchPosts.begin, (state, action) => {
    state.loading = true;
  });
  builder.addCase<void>(fetchPosts.finish, (state, action) => {
    state.loading = false;
  });
  builder.addCase<IPost[]>(fetchPosts.success, (state, action) => {
    state.posts = action.payload;
  });
  builder.addCase<Error>(fetchPosts.failure, (state, action) => {
    state.error = action.payload;
  });
})
```

Returns **any** State of reducer has immer

## unfoldSaga

Common saga helper that unifies handling side effects into only one standard form

### Parameters

- `body` **UnfoldSagaHandlerType**&#x20;
  - `body.action` **UnfoldSagaActionType** Action
  - `body.handler` **[Function][26]** Main handler function. Its returned value will become onSuccess callback param

### Examples

```javascript
import {SagaIterator} from 'redux-saga';
import {call, takeLatest} from 'redux-saga/effects';
import {unfoldSaga} from 'redux-unfold-saga-toolkit';
import {fetchPosts} from './action';

// Saga function
function* takeQueryPosts(action: UnfoldSagaActionType): Iterable<SagaIterator> {
  yield unfoldSaga({
  action: action,
  handler: function* () {
    const data = yield call(ApiPost.listPost);
    return data;
  },
 });
}

or

// Async function
function* takeQueryPosts(action: UnfoldSagaActionType): Iterable<SagaIterator> {
  yield unfoldSaga({
  action: action,
  handler: async function () {
    const data = await ApiPost.listPost();
    return data;
  },
 });
}

function* defaultSaga() {
  yield takeLatest('FETCH_POSTS', takeQueryPosts);
  // yield takeLatest(fetchPosts, takeQueryPosts);
  // yield takeLatest(fetchPosts.type, takeQueryPosts);
}
```

Returns **SagaIterator** SagaIterator

[1]: #createactiontypeonbegin
[2]: #parameters
[3]: #examples
[4]: #createactiontypeonfinish
[5]: #parameters-1
[6]: #examples-1
[7]: #createactiontypeonsuccess
[8]: #parameters-2
[9]: #examples-2
[10]: #createactiontypeonfailure
[11]: #parameters-3
[12]: #examples-3
[13]: #createaction
[14]: #parameters-4
[15]: #examples-4
[16]: #createstoreaction
[17]: #parameters-5
[18]: #examples-5
[19]: #createreducer
[20]: #parameters-6
[21]: #examples-6
[22]: #unfoldsaga
[23]: #parameters-7
[24]: #examples-7
[25]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String
[26]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

## License

MIT Â© [hungnguyen2809](https://github.com/hungnguyen2809)
